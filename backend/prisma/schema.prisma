// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum SessionType {
  Practice1
  Practice2
  Practice3
  Practice4
  Practice5
  Practice6
  HappyHour
  WarmUp
  Qualifying
  Race1
  Race2
  PreFinal
  Final
  Heat1
  Heat2
  Heat3
  Heat4
  Heat5
  Heat6
  Heat7
  SuperHeat1
  SuperHeat2
}

enum ClassCode {
  Micro
  Mini
  Sr
  Kz
  Ka
  Jr
}

enum RearHubsMaterial {
  Aluminium
  Magnesium
}

enum FrontHeight {
  Low
  Medium
  High
  Standard
}

enum BackHeight {
  Low
  Medium
  High
  Standard
}

enum FrontHubsMaterial {
  Aluminium
  Magnesium
}

enum FrontBar {
  Nylon
  Standard
  Black
  None
}

enum Spindle {
  Blue
  Standard
  Red
  Green
  Gold
}

model User {
  id           String       @id @default(uuid())
  email        String       @unique
  firstName    String
  lastName     String
  password     String?      // Only for managers
  isManager    Boolean      @default(false)
  isSuperAdmin Boolean      @default(false)  // Can access all team dashboards
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  submissions  Submission[]
  teamId       String?
  team         Team?        @relation(fields: [teamId], references: [id])
}

model Team {
  id              String       @id @default(uuid())
  slug            String       @unique
  name            String
  
  // Branding
  logoUrl         String?
  primaryColor    String       @default("#dc2626")
  
  // Email Configuration
  managerEmails   String[]     // All emails that receive notifications
  emailFromName   String?      // Custom "from" name for emails
  
  // Form Configuration (JSON)
  formConfig      Json?        // Which fields are enabled/required
  dropdownOptions Json?        // Custom tracks, championships, divisions
  
  users           User[]
  submissions     Submission[]
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model Submission {
  id                String            @id @default(uuid())
  userId            String
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  teamId            String?
  team              Team?             @relation(fields: [teamId], references: [id])
  sessionType       SessionType
  classCode         ClassCode         @default(Sr)
  track             String
  championship      String
  division          String
  engineNumber      String
  gearRatio         String?
  driveSprocket     String?
  drivenSprocket    String?
  carburatorNumber  String?
  tyreModel         String
  tyreAge           String
  tyreColdPressure  String
  chassis           String
  axle              String
  rearHubsMaterial  RearHubsMaterial
  rearHubsLength    String
  frontHeight       FrontHeight
  backHeight        BackHeight
  frontHubsMaterial FrontHubsMaterial?
  frontBar          FrontBar
  spindle           Spindle
  caster            String
  seatPosition      String
  lapTime           String?
  observation       String?
  customData        Json?             // Team-specific field values
  isFavorite        Boolean           @default(false)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  @@index([userId])
  @@index([teamId])
  @@index([createdAt])
}
